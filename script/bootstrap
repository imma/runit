#!/usr/bin/env bash

function bootstrap {
  if ! pkg ensure sysutils/daemontools; then
    mkdir -p "$WRKOBJDIR/sysutils/daemontools/work/.destdir/$HOME/install/bin"
    touch "$WRKOBJDIR/sysutils/daemontools/work/.destdir/$HOME/install/bin/svscanboot"
    pkg ensure sysutils/daemontools
  fi

  case "${DISTRIB_ID}" in
    Linux)
      ${NOSUDO} sudo apk add runit
      ;;
    *)
  rsync -ia $PKGWIPDIR/runit $PKGSRCDIR/sysutils/
  if ! pkg ensure sysutils/runit; then
    perl -pe 's{-static}{}' -i "$WRKOBJDIR/sysutils/runit/work/admin/runit-2.0.0/src/Makefile"
    pkg ensure sysutils/runit
  fi
      ;;
  esac
}

bootstrap
